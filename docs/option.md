选项说明
========

[文档目录](./README.md)

除了*输入输出*的两个参数外，其余参数都是可选的。

输入输出
--------

### 输入文件

参数格式：`FILENAME`

需要转换的文件，接受的文件格式：

* Bilibili 的 xml 文件，例如 `123456.xml`
* Niconvert 格式的 JSON 文件，例如 `123456.json`

JSON 的具体格式定义见[这里](./json.md)。

### 输出文件

参数格式：`-o/--output-filename FILENAME`

输出的 ass 字幕文件名。

弹幕选项
--------

这部分选项和过滤弹幕的行为有关。

### 过滤文件

参数格式：`-f/--custom--filter FILE`

使用文件配置进行过滤器，具体格式定义见[这里](./filter.md)。

### 过滤顶部弹幕

命令行开关：`-t/--top-filter`

启用此选项过滤顶部弹幕。

### 过滤底部弹幕

命令行开关：`-b/--bottom-filter`

启用此选项过滤底部弹幕。

### 过滤游客弹幕

命令行开关：`-g/--guest-filter`

启用此选项过滤游客弹幕。

字幕选项
--------

这部分选项和输出 ass 字幕文件有关，详细作用请自行搜索 ass 的规格。

选项的短格式都以 `+` 符号开头。

### 分辨率

参数格式：`+r/--play-resolution WIDTHxHEIGHT`

也就是 ass 格式中的开头的 `PlayResX` 和 `PlayResY` 的值，不需要跟视频实际分辨率一致，播放器会执行缩放。

默认值为 `1920x1080`。

### 字体名称

参数格式：`+f/--font-name NAME`

即是 ass 格式中的 `Style:` 行的字体名称。

默认值为自动选择：

* Windows 系统使用 `微软雅黑`
* 非 Windows 系统使用 `Source Han Sans SC`

### 字体大小

参数格式：`+s/--font-size SIZE`

即是 ass 格式中的 `Style:` 行的字体大小。

此为基准像素大小，即为原弹幕中的默认中号字体，大号和小号字体和会按此大小自动作相应的增减。

默认值为 `32`。

### 限制行数

参数格式：`+l/--line-count COUNT`

限制弹幕在上/下方几行，以免遮挡大部分画面。

如果为 `0`，则表示全屏，自动根据字体大小来算出最大行数。

默认值为 `4`。

### 布局算法

参数格式：`+a/--layout-algorithm sync|async`

自带两种布局算法：

* `sync` 速度同步，每一条滚动弹幕的移动速度都是相同的，避免弹幕重叠，容易看清弹幕内容，比较适合看剧集类的视频。
* `async` 速度异步，弹幕滚动速度取决于它的文本长度，可能在快移出时重叠，看上去比较有节奏感，比较适合看 MTV 类的视频。

因为是布局算法只是模拟出来，还有每种字体的字符实际可见宽度也未必等宽，所以和播放器实际效果不能完全相同。

默认值为 `sync`。

### 微调时长

参数格式：`+t/--tune-duration SECONDS`

如果感觉弹幕滚动得过快或者过慢，可以调整此参数，显示时间多加多少秒，正数为减慢，负数为加快。

默认值为 `0`。

### 丢弃偏移

参数格式：`+d/--drop-offset SECONDS`

因为避免弹幕重叠而使用了碰撞算法，总会有些时间点因为密度过大，而造成某些弹幕没有空位放下。因此需要延迟一下出现时间，这个参数就是允许延迟的最大长度，如果超过 N 秒都没有空位放下，那么这条弹幕就会被丢弃掉。

如果为 `0`，则表示不做延迟，马上丢弃掉。

默认值为 `2`。

### 底部边距

参数格式：`+b/--bottom-margin HEIGHT`

设置底部弹幕的边距，为了避免遮挡视频本身的对白字幕。

默认值为 `0`。

### 自定偏移

参数格式：`+b/--bottom-margin LENGTH`

如果字幕时间轴不合你的片源，则可以用这个选项整体偏移所有 ass 字幕行的时间轴。

这在转换流程的最后执行，即输出 ass 文件后再用其它 ass 编辑器来做偏移效果相同。

但这里可以使用更方便的 `hh:mm:ss` 的格式，同时也支持表达式计算，例如下面表示往后偏移两分钟：

```
120
00:120
00:00:120
2:00
02:00
00:02:00
4:00-2:00
62:00-60:00
100:02:00-100:00:00
-2:00+4:00
30+30+30+30
4:00-60-60
```

如果是负数，则表示往前偏移。

因为在命令行输入负数，以 `-` 开头会被当成选项解析，因此需要在前面加 `0` 来避免，例如 `0-2:00` 。

默认值为 `00:00`。

### 样式模板

参数格式：`+h/--header-file FILE`

自定义 ass 文件头的样式模板，内部自带文件是 [header.txt](../niconvert/libass/header.txt)，可以复制一份来修改。

以下占位符会根据选项值自动替换：

* `{width}` 分辨率宽度
* `{height}` 分辨率高度
* `{fontname}` 字体名称
* `{fontsize}` 字体大小

但是 `Style:` 行中的格式名必须是 `Danmaku`。

默认值为内部自带文件。
